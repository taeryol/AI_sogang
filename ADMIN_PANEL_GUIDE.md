# 🎛️ 관리자 패널 완벽 가이드

## 개요

관리자 패널은 AI 지식 관리 시스템의 모든 측면을 관리할 수 있는 종합 관리 도구입니다.

**접속 URL**: https://a85a98fe.webapp-31i.pages.dev/admin

---

## 📋 주요 기능

### 1. 대시보드 (Dashboard)

시스템의 전반적인 상태를 한눈에 파악할 수 있는 메인 화면입니다.

**표시 정보**:
- 📊 **전체 사용자 수**: 등록된 총 사용자 수
- 📄 **등록된 문서 수**: 인덱싱된 문서 총 개수
- 💬 **총 질의 수**: 시스템에서 처리한 질의 총 개수
- ⚡ **평균 응답시간**: AI 답변 생성 평균 소요 시간 (ms)

**최근 활동**:
- 최근 질의 내역 실시간 확인
- 사용자별 질문 및 답변 상태 모니터링
- 성공/실패 상태 확인

---

### 2. 사용자 관리 (User Management)

**기능**:
- ✅ 전체 사용자 목록 조회
- ✅ 사용자 역할 변경 (일반 사용자 ↔ 관리자)
- ✅ 사용자 삭제
- ✅ 사용자 정보 확인 (이메일, 가입일 등)

**사용자 정보 테이블**:
| 컬럼 | 설명 |
|------|------|
| ID | 사용자 고유 번호 |
| 이름 | 사용자 이름 |
| 이메일 | 로그인 이메일 |
| 역할 | 관리자 / 일반 사용자 |
| 가입일 | 계정 생성일시 |
| 작업 | 역할 변경, 삭제 버튼 |

**작업 가능 항목**:
1. **역할 변경**
   - 일반 사용자를 관리자로 승격
   - 관리자를 일반 사용자로 변경
   - ⚠️ 본인 계정은 변경 불가 (안전장치)

2. **사용자 삭제**
   - 사용자 계정 완전 삭제
   - 확인 메시지로 실수 방지
   - ⚠️ 삭제된 데이터는 복구 불가능

**새 관리자 추가 방법**:
- 관리자 코드 `ADMIN-SETUP-2025`를 사용하여 회원가입
- 메인 페이지 > 회원가입 > 관리자 코드 입력

---

### 3. 문서 관리 (Document Management)

**기능**:
- ✅ 등록된 모든 문서 목록 조회
- ✅ 문서 상태 확인 (인덱싱 완료, 처리 중, 실패)
- ✅ 문서 삭제
- ✅ 문서 메타데이터 확인

**문서 정보 테이블**:
| 컬럼 | 설명 |
|------|------|
| ID | 문서 고유 번호 |
| 제목 | 문서 제목 |
| 파일 | 원본 파일명 |
| 크기 | 파일 크기 (KB/MB) |
| 상태 | 인덱싱 완료 / 처리 중 / 실패 |
| 업로드일 | 문서 등록 일시 |
| 작업 | 삭제 버튼 |

**문서 상태**:
- 🟢 **인덱싱 완료**: 검색 가능한 상태
- 🟡 **처리 중**: 텍스트 추출 및 임베딩 생성 중
- 🔴 **실패**: 처리 중 오류 발생

**문서 업로드**:
- 메인 페이지에서 업로드 가능
- 관리자 패널에서 "문서 업로드" 버튼 클릭 시 메인 페이지로 이동

**지원 파일 형식**:
- ✅ TXT (텍스트 파일)
- ✅ MD (마크다운 파일)
- ⚠️ PDF, DOCX는 외부 파싱 서비스 필요 (향후 추가 예정)

---

### 4. 질의 기록 (Query History)

**기능**:
- ✅ 모든 사용자의 질의 내역 조회
- ✅ 질문 내용 및 답변 확인
- ✅ 응답 시간 및 상태 모니터링
- ✅ 사용자별 질의 추적

**표시 정보**:
- 👤 **사용자 ID**: 질문을 한 사용자
- ❓ **질문 내용**: 전체 질문 텍스트
- 💬 **답변 내용**: AI가 생성한 답변 (요약)
- ⏱️ **응답 시간**: 답변 생성 소요 시간
- ⏰ **질의 시간**: 질문이 제출된 일시
- ✅ **상태**: 성공 / 실패

**활용 방법**:
- 사용자 행동 패턴 분석
- 자주 묻는 질문(FAQ) 파악
- 시스템 성능 모니터링
- 답변 품질 개선 포인트 발견

---

### 5. API 설정 (API Settings)

시스템의 핵심 AI 기능을 제어하는 API 설정을 관리합니다.

#### 5.1 OpenAI 설정

**설정 항목**:

1. **API Key**
   - OpenAI API 키 입력
   - 비밀번호로 암호화 저장
   - 형식: `sk-...`
   - [OpenAI API Keys](https://platform.openai.com/api-keys)에서 발급

2. **GPT 모델**
   - `GPT-4`: 가장 강력한 모델 (추천)
   - `GPT-4 Turbo`: 빠른 속도, 저렴한 비용
   - `GPT-3.5 Turbo`: 경제적인 선택

3. **임베딩 모델**
   - `text-embedding-3-small`: 경제적이고 빠름 (추천)
   - `text-embedding-3-large`: 더 정확한 임베딩
   - `text-embedding-ada-002`: 레거시 모델

**설정 방법**:
```
1. OpenAI API 키 입력
2. 원하는 GPT 모델 선택
3. 임베딩 모델 선택
4. "저장" 버튼 클릭
```

#### 5.2 Vector DB 설정

**Vector DB 타입**:

1. **Simple (인메모리 - 개발용)**
   - 메모리에만 저장되는 간단한 벡터 DB
   - 서버 재시작 시 데이터 소실
   - 프로토타입 및 테스트용
   - ✅ 추가 설정 불필요

2. **Pinecone (프로덕션)**
   - 클라우드 기반 벡터 데이터베이스
   - 영구 저장 및 고성능 검색
   - 프로덕션 환경 권장
   - ⚠️ 별도 API 키 필요

**Pinecone 설정 (프로덕션 사용 시)**:

1. **Pinecone API Key**
   - Pinecone 대시보드에서 발급
   - 형식: `pcsk_...`
   - [Pinecone Console](https://app.pinecone.io/)

2. **Environment**
   - Pinecone 프로젝트의 환경 이름
   - 예: `us-west1-gcp`, `us-east-1-aws`

3. **Index Name**
   - 벡터 인덱스 이름
   - 기본값: `kms-embeddings`
   - 미리 생성 필요

**Pinecone 설정 방법**:
```
1. Vector DB 타입을 "Pinecone"으로 선택
2. Pinecone API Key 입력
3. Environment 입력
4. Index Name 입력 (또는 기본값 사용)
5. "저장" 버튼 클릭
```

**⚠️ 보안 주의사항**:
- API 키는 암호화되어 저장되지만 브라우저에서는 평문으로 표시됩니다
- 공용 컴퓨터에서 사용 시 주의하세요
- 정기적으로 API 키를 교체하는 것을 권장합니다

---

### 6. 감사 로그 (Audit Log)

**기능**:
- ✅ 모든 관리자 작업 기록 조회
- ✅ 작업 시간, 대상, 수행자 추적
- ✅ 시스템 변경 이력 관리

**기록되는 작업**:
- 🔄 **역할 변경**: 사용자 권한 변경 이력
- 🗑️ **사용자 삭제**: 계정 삭제 기록
- ⚙️ **설정 변경**: API 설정 변경 이력
- 📝 **기타 관리 작업**: 시스템 관리 활동

**로그 정보**:
| 컬럼 | 설명 |
|------|------|
| 시간 | 작업 수행 일시 |
| 작업 | 수행된 작업 유형 |
| 대상 사용자 | 작업 대상 사용자 ID |
| 세부사항 | 작업 상세 내용 |
| 수행자 | 작업을 수행한 관리자 ID |

**활용 방법**:
- 보안 감사 및 컴플라이언스
- 문제 발생 시 원인 추적
- 관리자 활동 모니터링
- 시스템 변경 이력 확인

---

## 🎨 UI/UX 특징

### 디자인
- 📱 **반응형 디자인**: 모든 화면 크기에 최적화
- 🎨 **현대적인 UI**: Tailwind CSS 기반 깔끔한 인터페이스
- 🌈 **컬러 코딩**: 상태별 색상으로 직관적 구분
- 🔔 **실시간 알림**: 작업 결과를 즉시 확인

### 탭 기반 내비게이션
- 빠른 기능 전환
- 현재 위치 명확한 표시
- 아이콘과 텍스트로 직관적 이해

### 에러 처리
- 상세한 에러 메시지
- 재시도 버튼 제공
- 콘솔 로그로 디버깅 지원

---

## 🔐 보안 기능

### 인증 및 권한
- ✅ JWT 토큰 기반 인증
- ✅ 관리자 권한 검증
- ✅ 자동 리다이렉트 (비인증 사용자)

### 데이터 보호
- ✅ API 키 암호화 저장
- ✅ 비밀번호 해싱 (SHA-256 + Salt)
- ✅ 본인 계정 수정 방지

### 감사 추적
- ✅ 모든 관리 작업 기록
- ✅ 변경 이력 영구 보존
- ✅ 수행자 정보 추적

---

## 📱 접근 방법

### 1. 메인 페이지에서
```
1. https://a85a98fe.webapp-31i.pages.dev 접속
2. 관리자 계정으로 로그인
3. 상단 내비게이션에서 "관리자" 클릭
```

### 2. 직접 URL 접근
```
https://a85a98fe.webapp-31i.pages.dev/admin
```

**⚠️ 주의**: 로그인하지 않았거나 관리자 권한이 없으면 자동으로 메인 페이지로 리다이렉트됩니다.

---

## 🧪 테스트 시나리오

### 시나리오 1: 새 관리자 추가
```
1. 메인 페이지에서 "회원가입" 클릭
2. 정보 입력 + 관리자 코드 "ADMIN-SETUP-2025" 입력
3. 가입 완료 후 로그인
4. 관리자 패널 접근 확인
5. 사용자 관리 탭에서 새 관리자 확인
```

### 시나리오 2: API 설정
```
1. 관리자 패널 > "API 설정" 탭
2. OpenAI API 키 입력
3. GPT-4 모델 선택
4. "저장" 클릭
5. 메인 페이지로 이동하여 질문 테스트
```

### 시나리오 3: 사용자 역할 변경
```
1. 관리자 패널 > "사용자 관리" 탭
2. 일반 사용자 선택
3. "역할 변경" 버튼 클릭
4. 확인 메시지에서 "확인"
5. 역할이 "관리자"로 변경되었는지 확인
6. 감사 로그에서 작업 기록 확인
```

---

## 🐛 문제 해결

### 관리자 페이지가 빈 화면으로 나타남
**원인**: localStorage에 인증 정보가 없거나 손상됨

**해결방법**:
```javascript
// 브라우저 콘솔에서 확인
console.log(localStorage.getItem('authToken'));
console.log(localStorage.getItem('currentUser'));

// 문제 시 다시 로그인
localStorage.clear();
location.href = '/';
```

### API 설정이 저장되지 않음
**원인**: 인증 토큰 만료 또는 권한 부족

**해결방법**:
1. 로그아웃 후 다시 로그인
2. 브라우저 개발자 도구 > 네트워크 탭에서 API 응답 확인
3. 401 오류 시 → 재로그인
4. 403 오류 시 → 관리자 권한 확인

### 사용자 목록이 로드되지 않음
**원인**: D1 데이터베이스 연결 문제 또는 API 오류

**해결방법**:
1. 브라우저 개발자 도구 > 콘솔 탭에서 에러 확인
2. 네트워크 탭에서 `/api/admin/users` 응답 확인
3. 500 오류 시 → 서버 로그 확인
4. 네트워크 오류 시 → 페이지 새로고침

---

## 📊 데이터베이스 스키마

관리자 패널이 사용하는 주요 테이블:

### users
```sql
- id: 사용자 고유 ID
- email: 이메일 (고유)
- name: 이름
- password_hash: 비밀번호 해시
- role: 역할 (user/admin)
- created_at: 생성일시
- updated_at: 수정일시
```

### api_settings
```sql
- id: 설정 ID
- setting_key: 설정 키
- setting_value: 설정 값
- encrypted: 암호화 여부
- updated_by: 수정한 관리자 ID
- created_at: 생성일시
- updated_at: 수정일시
```

### admin_codes
```sql
- id: 코드 ID
- code: 관리자 코드
- is_used: 사용 여부
- used_by: 사용한 사용자 ID
- created_by: 생성한 관리자 ID
- created_at: 생성일시
- used_at: 사용일시
```

### user_audit_log
```sql
- id: 로그 ID
- user_id: 대상 사용자 ID
- action: 작업 유형
- details: 작업 세부사항
- performed_by: 수행한 관리자 ID
- created_at: 작업 일시
```

---

## 🚀 향후 개선 계획

### 단기 (1-2주)
- [ ] 실시간 통계 자동 갱신
- [ ] 문서 직접 업로드 기능 추가
- [ ] 사용자 검색 및 필터링
- [ ] 엑셀 내보내기 기능

### 중기 (1-2개월)
- [ ] 대시보드 차트 및 그래프 추가
- [ ] 역할 기반 세분화 (편집자, 뷰어 등)
- [ ] 벌크 작업 (일괄 삭제, 역할 변경 등)
- [ ] 알림 센터 (중요 이벤트 알림)

### 장기 (3개월+)
- [ ] 고급 분석 및 리포트
- [ ] 사용자 활동 히트맵
- [ ] AI 성능 벤치마크
- [ ] 시스템 설정 백업/복원

---

## 📞 지원

문제가 발생하거나 새로운 기능이 필요한 경우:

1. **브라우저 콘솔 확인**: 개발자 도구 > Console 탭
2. **네트워크 로그 확인**: 개발자 도구 > Network 탭
3. **감사 로그 확인**: 관리자 패널 > 감사 로그 탭

---

**마지막 업데이트**: 2025-11-10  
**버전**: 2.0.0  
**상태**: ✅ 완전 작동
